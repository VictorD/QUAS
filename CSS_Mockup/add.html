<html>
<head>
 <meta name="viewport" content="width=device-width, initial-scale=1.0" /> 
<!-- <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet" /> -->
<script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.9.0.js"></script>
<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js"></script>

<title>QUAS - Your LTU knowledge database !</title>
<link rel="stylesheet" type="text/css" href="main.css"></link> 
</head>
<body id="main">
<div id="wrapper">

<div id="header">
	<div id="header-logo">
		QUAS
	</div>
	<div id="header-login">
		<a href="#">Login</a>
	</div>
</div>

<div id="search">
	<div id="search-logo">
		
	</div>
	<div id="search-wrapper">
		<form method="POST" target="#">
			<input id="search-bar" type="text" size="60"/>
			<input id="submit-button" type="submit" value="Search"/>
		</form>
	</div>
</div>
<div id="content">
	<!-- ko foreach: questions -->
	<div class="question">
		<div class="postQuestion" id="add">
		<form data-bind="submit: add">
		Title: <input data-bind="text: title" type="text" id="inputTitle" style="width: 100px;" ><br>
		Body: <textarea data-bind="value: body" rows="10" width="200"></textarea>
		<button data-bind="click:addQuestion" class="button" style="> Submit</button>
		</form>

	</div>
	</div>
	<div style="clear:both;">&nbsp;</div>
	<!-- /ko -->
</div>

<div id="footer">
</div>
</div>

<script type="text/javascript">
function QViewModel(){
	
	this.qURI = 'http://130.240.5.168:5000/questions/';
	window.questions = ko.observableArray();

	
	this.ajax = function(uri, method, data){
		var request = {
			url: uri,
			type: method,
			contentType: "application/json",
			accepts: "application/json",
			cache: false,
			dataType: 'jsonp',
			data: JSON.stringify(data)
		};
		return $.ajax(request);
	}
	
	
	
	// data.questions.length
	this.ajax(this.qURI, 'GET').done(function(data) {
		console.log("We are in ajax();");
		
		
		var ql = data.QuestionList;
		
		for (var i = 0; i < ql.length; i++) {
			console.log("In the loop #"+i);
			window.questions.push({
				uri: ko.observable(ql[i].uri),
				title: ko.observable(ql[i].title),
				body: ko.observable(ql[i].body),
				timestamp: ko.observable(ql[i].timestamp),
				done: ko.observable(ql[i].done)
			});
		} 
	});
	
	//adds add to TVM
	self.add = function(question){
		self.ajax(self.qURI, 'POST', question).done(function(data){
			
			// Kommer data.QL behövas här igen, eller räcker det med data.question. Den som lever får se.
			window.questions.push({
				uri:ko.observable(data.question.uri),
				title:ko.observable(data.question.title),
				body:ko.observable(data.task.body),
				// testa, behövs done.
				done:ko.observable(data.task.done)
			});
		});
	}
	
}

// ******* WIP ********
function AddQViewModel(){
	self.title = ko.observable();
	self.body = ko.observable();
	
	self.addQuestion = function(){
		$('#add').modal('show');
		QViewModel.add({
			title: self.title(),
			body: self.body()
		});
		self.title("");
		self.body("");
	}
}

ko.applyBindings(new QViewModel(), $('#content')[0]);
// Need "add" ko-tag in html
//ko.applyBindings(new AddQViewModel(), $('#add')[0]);
</script>
</body>
</html>
