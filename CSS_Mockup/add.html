<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0" /> 
<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
<script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.9.0.js"></script>
<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js"></script>

<title>QUAS - Your LTU knowledge database !</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<div class="navbar navbar-inverse">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="#">QUAS</a>
		</div>
		<div class="navbar-collapse collapse">
			<form class="navbar-form navbar-right">
				<button type="submit" class="btn btn-primary">Login</button>
			</form>
		</div>
	</div>
</div>

<div class="container">
	<div class="row text-center">
		<img src="logo.png" width="359px" height="220px"/>
	</div>
	<div class="row">
		<div class="col-lg-10 col-lg-offset-1">
				
			<form id="search" class="form-horizontal " role="form" method="POST" target="#">
				<div class="form-group">
						<div class="col-lg-7 col-lg-offset-2 ">
							<input id="search-bar" type="text" class="form-control"/>
						</div>
						<div class="col-lg-1">
							<input id="submit-button" type="submit" value="Search" class="btn btn-primary"/>
						</div>
				</div>
			</form>
		</div>
	</div>
	<div class="row">
		<div class="col-lg-6 col-lg-offset-3" id="add">
		<h1>Ask Question</h1>
			<form id="addQuestion" class="form-horizontal" role="form" data-bind="submit: add">
				<div class="form-group">
					<label class="col-lg-2 control-label" for="inputTitle">Title</label>
					<div class="col-lg-10">
					  <input data-bind="text: title" class="form-control" type="text" id="inputTitle" />
					</div>
				</div>
				<div class="form-group">
					<label class="col-lg-2 control-label" for="inputBody">Body</label>
					<div class="col-lg-10">
						<textarea data-bind="value: body" class="form-control" rows="10" id="inputBody"></textarea>				
					</div>
				</div>
				<button data-bind="click:addQuestion" class="button">Submit</button>
			</form>
		</div>
	</div>
</div>
</div>



<div id="footer">
</div>
</div>

<script type="text/javascript">
function QViewModel(){
	
	this.qURI = 'http://130.240.5.168:5000/questions/';
	window.questions = ko.observableArray();

	
	this.ajax = function(uri, method, data){
		var request = {
			url: uri,
			type: method,
			contentType: "application/json",
			accepts: "application/json",
			cache: false,
			dataType: 'jsonp',
			data: JSON.stringify(data)
		};
		return $.ajax(request);
	}
	
	
	
	// data.questions.length
	this.ajax(this.qURI, 'GET').done(function(data) {
		console.log("We are in ajax();");
		
		
		var ql = data.QuestionList;
		
		for (var i = 0; i < ql.length; i++) {
			console.log("In the loop #"+i);
			window.questions.push({
				uri: ko.observable(ql[i].uri),
				title: ko.observable(ql[i].title),
				body: ko.observable(ql[i].body),
				timestamp: ko.observable(ql[i].timestamp),
				done: ko.observable(ql[i].done)
			});
		} 
	});
	
	//adds add to TVM
	self.add = function(question){
		self.ajax(self.qURI, 'POST', question).done(function(data){
			
			// Kommer data.QL behövas här igen, eller räcker det med data.question. Den som lever får se.
			window.questions.push({
				uri:ko.observable(data.question.uri),
				title:ko.observable(data.question.title),
				body:ko.observable(data.task.body),
				// testa, behövs done.
				done:ko.observable(data.task.done)
			});
		});
	}
	
}

// ******* WIP ********
function AddQViewModel(){
	self.title = ko.observable();
	self.body = ko.observable();
	
	self.addQuestion = function(){
		$('#add').modal('show');
		QViewModel.add({
			title: self.title(),
			body: self.body()
		});
		self.title("");
		self.body("");
	}
}

ko.applyBindings(new QViewModel(), $('#content')[0]);
// Need "add" ko-tag in html
//ko.applyBindings(new AddQViewModel(), $('#add')[0]);
</script>
</body>
</html>
